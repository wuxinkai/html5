<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>选车</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/city.css">
    <script type="text/javascript" src="../js/bscroll.min.js"></script>
    <script type="text/javascript" src="../js/iscroll.js"></script>
    <script type="text/javascript" src="../js/city.js"></script>
    <script type="text/javascript" src="../js/zepto.min.js"></script>
</head>
<body>
<!--头部-->
<div class="public-header item-line">
    <span class="titles titles-left">北京</span>
    <input type="text" class="select-search" placeholder="找车">
    <img class="select-icon" src="../imgs/selectIcon.png" alt="">
</div>


<!--列表-->
<div class="city city-grid">
    <div class="city-wrapper city-wrapper-hook" style="top: 55px">
        <div>
            <div class="etron">
                <div class="title">
                    <i class="flame"></i>
                    <span>热门推荐</span>
                </div>
                <div class="etron-btn">
                    <div class="etron-btnIn">
                        <a class="active" href="javascript:;">轿车</a>
                        <a href="javascript:;">SUV</a>
                        <a href="javascript:;">MPV</a>
                    </div>
                </div>
                <div class="etron-car car-XM" id="scroller01">
                    <div class="scrollerIn" id="scrollerIn">
                        <dl>
                            <dt><img src="../imgs/carbanner.png" alt=""></dt>
                            <dd class="name">揽胜</dd>
                            <dd class="text">116.00-332.79万</dd>
                        </dl>
                        <dl>
                            <dt><img src="../imgs/car.png" alt=""></dt>
                            <dd class="name">揽胜</dd>
                            <dd class="text">116.00-332.79万</dd>
                        </dl>
                        <dl>
                            <dt><img src="../imgs/car.png" alt=""></dt>
                            <dd class="name">揽胜</dd>
                            <dd class="text">116.00-332.79万</dd>
                        </dl>
                        <dl>
                            <dt><img src="../imgs/carbanner.png" alt=""></dt>
                            <dd class="name">揽胜</dd>
                            <dd class="text">116.00-332.79万</dd>
                        </dl>
                        <dl>
                            <dt><img src="../imgs/car.png" alt=""></dt>
                            <dd class="name">揽胜</dd>
                            <dd class="text">116.00-332.79万</dd>
                        </dl>
                        <dl>
                            <dt><img src="../imgs/car.png" alt=""></dt>
                            <dd class="name">揽胜</dd>
                            <dd class="text">116.00-332.79万</dd>
                        </dl>
                    </div>
                </div>
                <div class="title">
                    <i class="trophy"></i>
                    <span>热门品牌</span>
                </div>
                <div class="etron-car car-logos">
                    <dl>
                        <dt><img src="../imgs/bmo.png" alt=""></dt>
                        <dd class="name">揽胜</dd>
                    </dl>
                    <dl>
                        <dt><img src="../imgs/aodi1.png" alt=""></dt>
                        <dd class="name">揽胜</dd>
                    </dl>
                    <dl>
                        <dt><img src="../imgs/volvo.png" alt=""></dt>
                        <dd class="name">揽胜</dd>
                    </dl>
                    <!--<dl>-->
                    <!--<dt><img src="../imgs/toyota.png" alt=""></dt>-->
                    <!--<dd class="name">揽胜</dd>-->
                    <!--</dl>-->
                </div>
            </div>
            <div class="scroller-hook">
                <div class="cities cities-hook"></div>
            </div>

        </div>
        <div class="shortcut shortcut-hook" id="fixeds"></div>
    </div>
</div>
</body>
</html>
<script>
    var cityWrapper = document.querySelector('.city-wrapper-hook');
    var cityScroller = document.querySelector('.scroller-hook');
    var cities = document.querySelector('.cities-hook');
    var shortcut = document.querySelector('.shortcut-hook');

    var scroll;

    var shortcutList = [];
    var anchorMap = {};

    function initCities() {
        var y = 0;
        var titleHeight = 32;
        var itemHeight = 120;

        var lists = '';
        var en = '<ul>';
        cityData.forEach(function (group,index) {
            var name = group.name;
            lists += '<div class="title" >'+name+'</div>';
            lists += '<ul class="num'+index+' ">';
            group.cities.forEach(function(g) {
                lists += '<li class="item item-logo" data-name="'+ g.name +'" data-id="'+ g.cityid +'"> <div class="logos-grid"><img class="logos" src="../imgs/bmo.png" alt=""></div><span class="border-1px name">'+ g.name +'</span></li>';
            });
            lists += '</ul>';
            var name = group.name.substr(0, 1);
            en += '<li data-anchor="'+name+'" class="item">'+name+'</li>';
            var len = group.cities.length;
            anchorMap[name] = y;
            y -= titleHeight + len * itemHeight;
        });
        en += '</ul>';

        cities.innerHTML = lists;
        shortcut.innerHTML = en;
        shortcut.style.top = 65 + 'px';
        var windowHeight=$(window).height()-120;
        var LiHeight=windowHeight/27;
        $(".shortcut-hook ul li").css('height',LiHeight+'px')
        scroll = new window.BScroll(cityWrapper, {
            probeType: 3
        });

        scroll.scrollTo(0, 0);
    }
    function bindEvent() {
        var touch = {};
        var firstTouch;
        shortcut.addEventListener('touchstart', function (e) {
            var anchor = e.target.getAttribute('data-anchor');
            firstTouch = e.touches[0];
            touch.y1 = firstTouch.pageY;
            touch.anchor = anchor;
            scrollTo(anchor);
        });
        shortcut.addEventListener('touchmove', function (e) {
            firstTouch = e.touches[0];
            touch.y2 = firstTouch.pageY;
            var anchorHeight = 16;
            var delta = (touch.y2 - touch.y1) / anchorHeight | 0;
            var anchor = shortcutList[shortcutList.indexOf(touch.anchor) + delta];
            scrollTo(anchor);
            e.preventDefault();
            e.stopPropagation();
        });
        function scrollTo(anchor) {
            var maxScrollY = cityWrapper.clientHeight - cityScroller.clientHeight;
            var y = Math.min(0, Math.max(maxScrollY, anchorMap[anchor]));
            if (typeof y !== 'undefined') {
                scroll.scrollTo(0, y);
            }
        }
    }
    initCities();
    bindEvent();
    $('.etron-btnIn a').bind("touchend",function(){
        $(this).addClass("active").siblings().removeClass("active")
    });
    $('.cities-hook ul li').bind("touchend",function(){
//        alert(  $(this).text());
        $(this).addClass("active").siblings().removeClass("active")
    });

    var oParent=document.getElementById('scrollerIn');
    var aChil=oParent.getElementsByTagName('dl');
    oParent.style.width=aChil.length*11+'rem';
    var myScroll = new IScroll('#scroller01', {
        disableMouse: true,
        disablePointer: true,
        scrollX : true,
        scrollY : false,
    });
</script>